<!DOCTYPE html>
<html>
<head>
<title>Test Form</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="files/jquery/jquery.js"></script>
<script src="files/jquery/jquery-ui.js"></script>
<script src="files/jquery/jquery.blockUI.js"></script>
<script src="files/bootstrap/bootstrap.min.js"></script>
<script src="files/bootstrap/bootstrap-select.js"></script>

<link href="files/jquery/jquery-ui.css" rel="stylesheet" />
<link href="files/bootstrap/bootstrap.css" rel="stylesheet" />
<link href="files/bootstrap/bootstrap-select.css" rel="stylesheet" />

<!-- 
Values expected for Mongolia ( for the "HTTP parameters" -> "Collect format" conversion to work )

All inputs that have processable information ( hidden or otherwise) should start with "collect_" :

If the input is text then it should be followed by "text_"
If the input is a code (option in combo-box for instance) then it should be followed by "code_"
If the input is a date then it should be followed by "date_"
If the input is a coordinate then it should be followed by "coord_"  ( the value expected has the format "longitude,latitude" )
If the input is an integer then it should be followed by "integer_"
If the input is a boolean then it should be followed by "boolean_"

When multiple values can be sent ( in a multiple select for instance ) the data sent in the Http parameters has to be separated using " " ( a space ) 

So, for Mongolia we expect these values :
collect_text_id
collect_coord_location
collect_text_operator
collect_code_land_use
collect_boolean_land_use_change
collect_code_land_use_type
collect_code_topography_accessibility
collect_code_topography_elements
collect_code_topography_coverage
collect_code_human_impact_type
collect_code_human_impact_grade
collect_integer_human_impact_year
collect_date_rs_date
collect_code_rs_satellite
collect_code_crown_cover
collect_code_crown_type
collect_boolean_actively_saved // Set this to true when the user saves the data by actively clicking in submit


 -->

<script>
	var collapsedState = false;

	var fillYears = function() {

		for (year = new Date().getFullYear(); year > 1950; year--) {
			$('#humanImpactTime').append( $("<option></option>").attr("value", year).text( year) );
		}
	}

	var toggleCollapsed = function() {
		if (collapsedState == false) {
			$('#collapsableContents').hide();
			$('#collapseButton').attr("class", "icon-large icon-resize-full");
			
			collapsedState = true;
		} else {
			$('#collapsableContents').show();
			$('#collapseButton').attr("class", "icon-large icon-resize-small");
			collapsedState = false;
		}
	        
		document.getElementById('dummy').src = "about:blank";
	}

	var forceWindowCloseAfterDialogCloses = function($dialog) {
		$dialog.on("dialogclose", function(event, ui) {
			window.open("#$[next_id];balloonFlyto");
			
		});
	}
	
	var enableSelect = function( selectName, enable ){ //#elementsCover

		if( enable == true  ){
			 $(selectName).prop('disabled',false);
		}else{
			 $(selectName).prop('disabled',true);
		}
		
		$(selectName).selectpicker('refresh');
		
	}
	
	var toggleDependantSelect = function( parentSelect, nameDependantSelect ){ //#elementsCover

		var elementSelected = false;
		$( parentSelect + " option:selected").each(function () {        
			elementSelected = true;    
		});  

		enableSelect( nameDependantSelect, elementSelected );
		
		
	}

	var checkIfPlacemarkAlreadyFilled = function(formName) {

		data = $( formName + " :input[value]").serialize();

		$.ajax({
					data : data,
					type : "POST",
					url : "http://localhost:8093/eye/placemarkInfo",
					dataType : 'json',
					error : function(jqXHR, textStatus, errorThrown) {
						$('#succ_mess').css("color", "red").html( "The data server is not running!");
						$("#dialogSuccess").dialog( "open" );
					},
					success : function(json) {
						if (json.type == 'success') {
							$('#succ_mess').css("color", "red").html( "The data for this placemark has already been filled");
							$("#dialogSuccess").dialog( "open" );
							forceWindowCloseAfterDialogCloses($("#dialogSuccess"));
						}

					}
				});
	}

	$(document).ready(
					function() {

					
						$('a[data-toggle="tab"]').on('shown', function(e) {
							var selectedTab = e.target;
							var idSelected = selectedTab.name;
							$("input[id=collect_code_land_use]").val(idSelected);

						});

						$('#forestType').change(function() {
							var idSelected = $(this).attr("id");
							$("input[id=collect_code_land_use_type]").val(idSelected);
							$("#crownCoverDiv").show();
						});

						$('#radioCrown').change(function() {
							var idSelected = $(this).attr("id");
							$("input[id=collect_code_crown_cover]").val(idSelected);
							$("#imageResolutionDiv").show();
						});
						
						$('#humanImpactType').change(function() {
							var selectedValues = $(this).val(); // If the human impact is "noImpact" then diable the other inputs
							
							if(selectedValues.length > 1 && jQuery.inArray( "noImpact", selectedValues) !== -1 ) {
								$(this).selectpicker('deselectAll');
								$(this).selectpicker('val', "noImpact");
								$(this).selectpicker('refresh');
								
							}
							
							$('.humanImpactInput').each(function(){
								if( jQuery.inArray( "noImpact", selectedValues) !== -1 ) {
									$(this).prop('disabled',true);
									$(this).selectpicker('deselectAll');
								}else{
									$(this).prop('disabled',false);
								}
								$(this).selectpicker('refresh');
							});
							
						});
						

						fillYears();
						
						
						// Declares the Jquery Dialog ( The Bootstrap dialog does not work in Google Earth )
						 $( "#dialogSuccess" ).dialog({
							 modal: true,
							 autoOpen: false,
							 buttons: {
							 	Ok: function() {
									 $( this ).dialog( "close" );
							 	}
							 }
						});
						
						// Mark the selects as "bootstratp-select" enabled 
						$('.selectpicker').selectpicker();


						
						$("#elements").change( function(){
								toggleDependantSelect("#elements", '#elementsCover');
							}
						);
						
						$('.toggleLandDevelopment').on('click', function(e) {
							var selectedButton = e.target;
							$("input[id=collect_boolean_land_use_change]").val( selectedButton.val() );
						});
						
					
						// Initialize forest specific properties
						$("#crownCoverDiv").hide();
						
						$('.toggleForestDevelopment').on('click', function(e) {
							var that = $(this);
							
							if (that.attr("id") == "FLtoFL") {
								$('#otToFlGroup').attr("disabled", true);
								$('#flToFlGroup').attr("disabled", false);
							} else {
								$('#flToFlGroup').attr("disabled", true);
								$('#otToFlGroup').attr("disabled", false);
								
							}
							
							enableSelect('#forestType', true );
							
						});

						// SAVING DATA WHEN WINDOW CLOSES
					    // Bind event to Before user leaves page with function parameter e
					    $(window).bind('beforeunload', function(e) {    
					    	alert("fff");
					    	var $form = $(this);
														
							var data = $("#formAll :input[value]").serialize();

							$ajax({
								data : data,
								type : $form.attr("method"),
								url : $form.attr("action"),
								dataType : 'json'
							});
					    })
					    
					    // SAVING DATA WHEN USER SUBMITS
						$('#formAll').submit(
							function(e) {
								e.preventDefault();
								
								// Mark this as the "real submit" (as opposed when saving data just because the user closes the window) so we can show the placemark as interpreted
								$("input[id=collect_boolean_actively_saved]").val("true");


								$.blockUI({
									message : 'Sumitting data..'
								});
								// unblock when ajax activity stops 
								$(document).ajaxStop($.unblockUI);
								
								var $form = $(this);

								var data = $( "#formAll :input[value]").serialize();

								$.ajax({
									data : data,
									type : $form.attr("method"),
									url : $form.attr("action"),
									dataType : 'json',
									error : function(jqXHR,textStatus,errorThrown) {
										$('#succ_mess').css("color","red").html("Cannot save the data, the data server is not running!");
										$("#dialogSuccess").dialog"open");
									},
									success : function(json) {
										if (json.type == 'success') {
											$('#succ_mess').css("color","green").html(json.message);
											forceWindowCloseAfterDialogCloses($("#dialogSuccess"));
										} else if (json.type == 'warning') {
											$('#succ_mess').css("color","yellow").html(json.message);
										} else if (json.type == 'error') {
											$('#succ_mess').css("color","red").html(json.message);
										}
										$("#dialogSuccess").dialog("open");
									}
								});
							});

						checkIfPlacemarkAlreadyFilled('#formAll');

					});
</script>
<style type="text/css">
body {
	font-family: "Trebuchet MS", "Helvetica", "Arial", "Verdana",
		"sans-serif";
}

.selectDiv {
	border: 2px solid #5F5D69;
	border-top-left-radius: 6px;
	border-top-right-radius: 6px;
	width: 95%;
	margin-left: 3px;
}

.selectDiv h2 {
	padding: 2px;
	color: #5F5D69;
	line-height: 20px;
	background-color: #F6F5FF;
	font-size: 8pt; /* or whatever */
	margin-bottom: 10px;
	margin-top: 5px;
}

.lowerDivs {
	position: relative !important;
	display: inline-block !important;
	float: left;
	width: 95%;
	margin-left: 3px;
}

.add-on {
	width: 100px !important;
}

.input-prepend .add-on, .input-prepend .btn {
    margin-left: 4px;
}

label {
	display: inline;
}

hr {
	margin: 5px;
}


.bootstrap-select:not([class*="span"]) {
    width: 170px;
}

.bootstrap-select {
    width: 170px\9; /*IE8 and below*/
}

</style>

</head>

	<div id="dialogSuccess">
		
			<span class="ui-icon ui-icon-circle-check"
				style="float: left; margin: 0 7px 50px 0;"> </span>
			<div id="succ_mess"></div>
		
	</div>
	
<body>


	<div id="contentDiv" style="width: 450px">

			<form id="formAll" method="POST" action="http://localhost:8093/eye/saveData">

				<input type="hidden" id="collect_code_land_use" name="collect_code_land_use"
					value="" /> 
				<input type="hidden" id="collect_code_land_use_type"
					name="collect_code_land_use_type" value="" /> 
				
				
				<input type="hidden"
					id="collect_boolean_land_use_change" name="collect_boolean_land_use_change" value="" /> 
					
				<input
					type="hidden" id="collect_coord_location" name="collect_coord_location" value="$[longitude],$[latitude]" />
				
				<input type="hidden" id="collect_text_id"
					name="collect_text_id" value="$[id]" />
					
				<input type="hidden" id="collect_boolean_actively_saved"
					name="collect_boolean_actively_saved" value="false" />


				<button class="btn btn-link" onclick="toggleCollapsed(); return false;"><i  class="icon-large icon-resize-small" id="collapseButton"></i></button>
				<span style="align: right;">LAND USE TYPE <img src="files/img/mongolia.png" border="0" style="margin:5px;"/></span>

				<div id="collapsableContents">
					<div id="tabsTypeOfTerrain">
	
						<ul class="nav nav-tabs">
							<li class="active"><a href="#tabsForest" name="forest"
								data-toggle="tab">Forest</a></li>
							<li><a href="#tabsCropland" name="cropland" data-toggle="tab">Cropland</a></li>
							<li><a href="#tabsGrassland" name="grassland"
								data-toggle="tab">Grassland</a></li>
							<li><a href="#tabsWetland" name="wetland" data-toggle="tab">Wetland</a></li>
							<li><a href="#tabsSettlement" name="settlement"
								data-toggle="tab">Settlement</a></li>
							<li><a href="#tabsOther" name="otherLand" data-toggle="tab">Other
									land</a></li>
							<!-- 	 // removed class container  -->
							
						</ul>
					</div>

					<div class="tab-content">
					<div id="tabsForest" class="tab-pane active">

						<div id="forestTypeDiv" class="selectDiv" >
							<h2>Forest Type</h2>
							<div class="control-group">
								<table style="width: 100%; align: middle">
									<tr>
										<td align="center">
											<div class="btn-group" data-toggle="buttons-radio">
												<button type="button" class="btn btn-primary  btn-small toggleForestDevelopment toggleLandDevelopment"
													id="FLtoFL" name="radioCrown" value="false">FL &gt; FL</button>
												<button type="button" class="btn btn-primary btn-small toggleForestDevelopment toggleLandDevelopment"
													id="OLtoFL" value="true">Other &gt; FL</button>
											</div>
										</td>
									</tr>
								</table>
								<hr />
								<div class="input-prepend">
									<span class="add-on">Type</span> 
									
									<select disabled="true"
										class="selectpicker  show-tick show-menu-arrow "
										id="collect_code_land_use_type" title="No type selected"
										data-container=".tabsForest">
										<optgroup label="FL > FL" disabled id="flToFlGroup">
											<option>Birch-Aspen</option>
											<option>Larch</option>
											<option>Pine</option>
											<option>Siberian Pine</option>
											<option>Spruce</option>
											<option>Saxaul</option>
										</optgroup>
										<optgroup label="OL > FL" disabled  id="otToFlGroup">
											<option>Coniferous and deciduous</option>
											<option>Saxaul</option>
											<option>Shrubs</option>
											<option>Open</option>
										</optgroup>
									</select>
								</div>
							</div>

						</div>

						<div id="crownCoverDiv" class="selectDiv">
							<h2>Crown Cover</h2>
							<div class="input-prepend">
								<span class="add-on">Cover</span> 
								<select
									class="selectpicker  show-tick show-menu-arrow "
									id="collect_code_crown_cover" title="Nothing selected"
									data-container=".tabsForest" >
									<option>No cover</option>
									<optgroup label="No cover" disabled >
											<option value="burnt">Burnt</option>
											<option value="logging">Logging</option>
											<option value="other">Other</option>
										</optgroup>
									<option data-divider="true"></option>
									<option value="10-30">10-30%</option>
									<option value="30-50">30-50%</option>
									<option value="50-70">50-70%</option>
									<option value="70-100">70-100%</option>
								</select>
								
								<select
									class="selectpicker  show-tick show-menu-arrow "
									id="collect_code_crown_type" title="Nothing selected"
									data-container=".tabsForest"  data-width="110px">
									
									<option value="sparse">Sparse</option>
									<option value="grouped">Grouped</option>
									<option value="linear">Linear</option>
									<option value="unknown">Unknown</option>
								</select>
								
							</div>
							
							
						</div>
					</div>

					<div id="tabsCropland" class="tab-pane">
						<div id="croplandTypeDiv" class="selectDiv">
							<h2>Forest Type</h2>
							<h2>Cropland</h2>
							<div class="control-group">
								<table style="width: 100%; align: middle">
									<tr>
										<td align="center">
											<div class="btn-group" data-toggle="buttons-radio">
												<button type="button"
													class="btn btn-primary  btn-small toggleLandDevelopment"
													id="CLtoCL" name="radioCrown">CL &gt; CL</button>
												<button type="button"
													class="btn btn-primary btn-small toggleLandDevelopment"
													id="OTtoCL">Other &gt; CL</button>
											</div>
										</td>
									</tr>
								</table>
								<hr />
								<div class="input-prepend">
									<span class="add-on">Cropland Type</span> 
									
									<select
										class="selectpicker  show-tick show-menu-arrow "
										id="croplandType" title="No type selected"
										data-container=".tabsCropland" disabled>

										<option>Irrigated</option>

									</select>
								</div>
							</div>
						</div>
					</div>
					<div id="tabsOther" class="tab-pane">
							<h2>Content heading 3</h2>
							<p>Mauris eleifend est et turpis. Duis id erat. Suspendisse
								potenti. Aliquam vulputate, pede vel vehicula accumsan, mi neque
								rutrum erat, eu congue orci lorem eget lorem. Vestibulum non
								ante. Class aptent taciti sociosqu ad litora torquent per
								conubia nostra, per inceptos himenaeos. Fusce sodales. Quisque
								eu urna vel enim commodo pellentesque. Praesent eu risus
								hendrerit ligula tempus pretium. Curabitur lorem enim, pretium
								nec, feugiat nec, luctus a, lacus.</p>
							<p>Duis cursus. Maecenas ligula eros, blandit nec, pharetra
								at, semper at, magna. Nullam ac lacus. Nulla facilisi. Praesent
								viverra justo vitae neque. Praesent blandit adipiscing velit.
								Suspendisse potenti. Donec mattis, pede vel pharetra blandit,
								magna ligula faucibus eros, id euismod lacus dolor eget odio.
								Nam scelerisque. Donec non libero sed nulla mattis commodo. Ut
								sagittis. Donec nisi lectus, feugiat porttitor, tempor ac,
								tempor vitae, pede. Aenean vehicula velit eu tellus interdum
								rutrum. Maecenas commodo. Pellentesque nec elit. Fusce in lacus.
								Vivamus a libero vitae lectus hendrerit hendrerit.</p>
						</div>
						<div id="tabsGrassland" class="tab-pane">
							<h2>Content heading 3</h2>
							<p>Mauris eleifend est et turpis. Duis id erat. Suspendisse
								potenti. Aliquam vulputate, pede vel vehicula accumsan, mi neque
								rutrum erat, eu congue orci lorem eget lorem. Vestibulum non
								ante. Class aptent taciti sociosqu ad litora torquent per
								conubia nostra, per inceptos himenaeos. Fusce sodales. Quisque
								eu urna vel enim commodo pellentesque. Praesent eu risus
								hendrerit ligula tempus pretium. Curabitur lorem enim, pretium
								nec, feugiat nec, luctus a, lacus.</p>
							<p>Duis cursus. Maecenas ligula eros, blandit nec, pharetra
								at, semper at, magna. Nullam ac lacus. Nulla facilisi. Praesent
								viverra justo vitae neque. Praesent blandit adipiscing velit.
								Suspendisse potenti. Donec mattis, pede vel pharetra blandit,
								magna ligula faucibus eros, id euismod lacus dolor eget odio.
								Nam scelerisque. Donec non libero sed nulla mattis commodo. Ut
								sagittis. Donec nisi lectus, feugiat porttitor, tempor ac,
								tempor vitae, pede. Aenean vehicula velit eu tellus interdum
								rutrum. Maecenas commodo. Pellentesque nec elit. Fusce in lacus.
								Vivamus a libero vitae lectus hendrerit hendrerit.</p>
						</div>
						<div id="tabsWetland" class="tab-pane">
							<h2>Content heading 3</h2>
							<p>Mauris eleifend est et turpis. Duis id erat. Suspendisse
								potenti. Aliquam vulputate, pede vel vehicula accumsan, mi neque
								rutrum erat, eu congue orci lorem eget lorem. Vestibulum non
								ante. Class aptent taciti sociosqu ad litora torquent per
								conubia nostra, per inceptos himenaeos. Fusce sodales. Quisque
								eu urna vel enim commodo pellentesque. Praesent eu risus
								hendrerit ligula tempus pretium. Curabitur lorem enim, pretium
								nec, feugiat nec, luctus a, lacus.</p>
							<p>Duis cursus. Maecenas ligula eros, blandit nec, pharetra
								at, semper at, magna. Nullam ac lacus. Nulla facilisi. Praesent
								viverra justo vitae neque. Praesent blandit adipiscing velit.
								Suspendisse potenti. Donec mattis, pede vel pharetra blandit,
								magna ligula faucibus eros, id euismod lacus dolor eget odio.
								Nam scelerisque. Donec non libero sed nulla mattis commodo. Ut
								sagittis. Donec nisi lectus, feugiat porttitor, tempor ac,
								tempor vitae, pede. Aenean vehicula velit eu tellus interdum
								rutrum. Maecenas commodo. Pellentesque nec elit. Fusce in lacus.
								Vivamus a libero vitae lectus hendrerit hendrerit.</p>
						</div>
						<div id="tabsSettlement" class="tab-pane">
							<h2>Content heading 3</h2>
							<p>Mauris eleifend est et turpis. Duis id erat. Suspendisse
								potenti. Aliquam vulputate, pede vel vehicula accumsan, mi neque
								rutrum erat, eu congue orci lorem eget lorem. Vestibulum non
								ante. Class aptent taciti sociosqu ad litora torquent per
								conubia nostra, per inceptos himenaeos. Fusce sodales. Quisque
								eu urna vel enim commodo pellentesque. Praesent eu risus
								hendrerit ligula tempus pretium. Curabitur lorem enim, pretium
								nec, feugiat nec, luctus a, lacus.</p>
							<p>Duis cursus. Maecenas ligula eros, blandit nec, pharetra
								at, semper at, magna. Nullam ac lacus. Nulla facilisi. Praesent
								viverra justo vitae neque. Praesent blandit adipiscing velit.
								Suspendisse potenti. Donec mattis, pede vel pharetra blandit,
								magna ligula faucibus eros, id euismod lacus dolor eget odio.
								Nam scelerisque. Donec non libero sed nulla mattis commodo. Ut
								sagittis. Donec nisi lectus, feugiat porttitor, tempor ac,
								tempor vitae, pede. Aenean vehicula velit eu tellus interdum
								rutrum. Maecenas commodo. Pellentesque nec elit. Fusce in lacus.
								Vivamus a libero vitae lectus hendrerit hendrerit.</p>
						</div>

					</div>



					<div id="commonDivs">
						<div id="topographyDiv" class="selectDiv lowerDivs">
							<h2>Topography</h2>
							<div class="input-prepend">
								<span class="add-on">Accesibility</span> <select
									class="selectpicker  show-tick show-menu-arrow "
									id="collect_code_topography_accessibility" title="No accesibility selected">
									<option value="0-1">D&lt;1km</option>
									<option value="1-5">1km&lt;D&lt;5km</option>
									<option value="5-10">5km&lt;D&lt;10km</option>
									<option value="10-more">10km&lt;D</option>
								</select>
							</div>
							<hr />
							<div class="input-prepend">
								<span class="add-on">Elements</span> <select
									class="selectpicker show-tick show-menu-arrow " multiple
									id="collect_code_topography_elements" title="No element selected">
									<option value="road">Road</option>
									<option value="river">River</option>
									<option value="house">House</option>
									<option value="other">Other</option>
								</select>
								<select
									class="selectpicker show-tick show-menu-arrow " disabled
									id="collect_code_topography_coverage" title="No cover selected" data-width="110px">
									<option value="0-10">0-10%</option>
									<option value="10-30">10%-30%</option>
									<option value="30-60">30%-60%</option>
									<option value="60-100">60%-100%</option>
								</select>
							</div>
						</div>

						<div id="humanImpactDiv" class="selectDiv lowerDivs">
							<h2>Human impact</h2>

							<div class="input-prepend">
								<span class="add-on">Type</span> 
								<select
									class="selectpicker  show-menu-arrow show-tick"
									id="collect_code_human_impact_type" multiple
									data-selected-text-format="count>3" title="No type selected">
									<option>No impact</option>
									<option value="logging">Logging</option>
									<option value="fire">Fire</option>
									<option value="grazzing">Grazzing</option>
									<option value="mining">Mining</option>
									<option value="other">Other</option>
								</select>
								
							</div>
							<HR />
							<div class="input-prepend">
								<span class="add-on">Grade</span> 
								<select
									class="selectpicker  show-menu-arrow show-tick humanImpactInput"
									id="collect_code_human_impact_grade" title="No grade selected" disabled >
									<option value="low">Low</option>
									<option value="medium">Medium</option>
									<option value="high">High</option>
								</select>
							</div>
							<HR />
							<div class="input-prepend">
								<span class="add-on">Time</span> 
								<select
									class="selectpicker  show-menu-arrow show-tick humanImpactInput" data-size="3"
									id="collect_integer_human_impact_year" title="No year selected" disabled>
									<option>Unknown</option>
								</select>
							</div>
							
						</div>
						<div id="satelliteDiv" class="selectDiv lowerDivs">
							<h2>RS Data</h2>
							<div class="input-prepend">
								<span class="add-on">Date</span>
								 <input type="text" id="collect_date_rs_date" placeholder="Date of the interpreted image" id="">
								
							</div>
							<div class="input-prepend">
								<span class="add-on">Satellite</span> 
								<select id="collect_code_rs_satellite"
									class="selectpicker show-tick show-menu-arrow ">
									<option value="rapidEye">Rapid Eye</option>
									<option value="landsatt">Landsat</option>
									<option value="queickbird">Quickbird</option>
									<option value="other">Other</option>
								</select>
							</div>
						</div>

						<div class="form-actions" style="clear: both" class="lowerDivs">
							<button type="submit" class="btn btn-primary btn-small">Save
								changes</button>
						</div>


					</div>


				</div>

			</form>
		</div>
	
	<iframe style="display: none" id="dummy" src="about:blank"></iframe>
</body>
</html>
